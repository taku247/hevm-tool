# KittenSwap çµ±åˆã‚¬ã‚¤ãƒ‰

## ğŸ“‹ æ¦‚è¦

KittenSwapã¯ã€HyperEVMãƒã‚§ãƒ¼ãƒ³ä¸Šã®Decentralized Exchangeï¼ˆDEXï¼‰ã§ã™ãŒã€æ¨™æº–çš„ãªUniswap V2å®Ÿè£…ã¨ã¯ç•°ãªã‚‹ç‰¹æ®Šãªå®Ÿè£…ã‚’æŒã£ã¦ã„ã¾ã™ã€‚æœ¬ã‚¬ã‚¤ãƒ‰ã§ã¯ã€KittenSwapã¨ã®çµ±åˆæ™‚ã«ç™ºç”Ÿã™ã‚‹å•é¡Œã¨è§£æ±ºç­–ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ” èª¿æŸ»çµæœã‚µãƒãƒªãƒ¼

### åŸºæœ¬æƒ…å ±
- **ãƒã‚§ãƒ¼ãƒ³**: HyperLiquid EVM (Mainnet)
- **ãƒ—ãƒ­ãƒˆã‚³ãƒ«**: Uniswap V2ãƒ™ãƒ¼ã‚¹ï¼ˆã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…ï¼‰ + **V3ãƒ•ãƒ«å¯¾å¿œ** ğŸ†•
- **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¼ãƒ«**: 70å€‹ã®V2ãƒ—ãƒ¼ãƒ« + **201å€‹ã®V3ãƒ—ãƒ¼ãƒ«** ğŸ†•
- **å¯¾å¿œãƒˆãƒ¼ã‚¯ãƒ³**: 13ç¨®é¡ä»¥ä¸Šï¼ˆç¶™ç¶šçš„ã«æ‹¡å¤§ä¸­ï¼‰
- **V3ãƒ—ãƒ¼ãƒ«**: **å®Œå…¨ç¨¼åƒä¸­** âœ… (2025å¹´7æœˆ9æ—¥ç¢ºèª)

### Factoryå¥‘ç´„åˆ†æ
| å¥‘ç´„å | ã‚¢ãƒ‰ãƒ¬ã‚¹ | ç”¨é€” | åˆ©ç”¨å¯èƒ½æ€§ |
|--------|---------|------|------------|
| V2_PairFactory | `0xDa12F450580A4cc485C3b501BAB7b0B3cbc3B31B` | V2ãƒ—ãƒ¼ãƒ«ç®¡ç† | âœ… åˆ©ç”¨å¯èƒ½ |
| **V3_CLFactory** | `0x2E08F5Ff603E4343864B14599CAeDb19918BDCaF` | **V3ãƒ—ãƒ¼ãƒ«ç®¡ç†** | **âœ… 201ãƒ—ãƒ¼ãƒ«ç¨¼åƒä¸­** ğŸ†• |
| GaugeFactory | `0x72490535A73cf5C66c3BC573B5626DE187DcE9E4` | ã‚²ãƒ¼ã‚¸ç®¡ç† | âŒ èª¿æŸ»ä¸­ |
| VotingRewardFactory | `0x9f7dc78cA10798fE1C5c969b032596A3904db3eE` | æŠ•ç¥¨å ±é…¬ | âŒ èª¿æŸ»ä¸­ |
| FactoryRegistry | `0x8C142521ebB1aC1cC1F0958037702A69b6f608e4` | ãƒ¬ã‚¸ã‚¹ãƒˆãƒª | âŒ èª¿æŸ»ä¸­ |

### Phase 2 ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆï¼ˆV3ã‚·ã‚¹ãƒ†ãƒ ï¼‰ğŸ†•
| å¥‘ç´„å | ã‚¢ãƒ‰ãƒ¬ã‚¹ | ç”¨é€” | å‹•ä½œçŠ¶æ³ |
|--------|---------|------|---------|
| **QuoterV2** | `0xd9949cB0655E8D5167373005Bd85f814c8E0C9BF` | **V3ãƒ¬ãƒ¼ãƒˆå–å¾—** | **âœ… å®Œå…¨å‹•ä½œ** |
| **SwapRouter** | `0x8fFDB06039B1b8188c2C721Dc3C435B5773D7346` | **V3ã‚¹ãƒ¯ãƒƒãƒ—å®Ÿè¡Œ** | **âœ… åˆ©ç”¨å¯èƒ½** |
| **NFP** | `0xB9201e89f94a01FF13AD4CAeCF43a2e232513754` | **æµå‹•æ€§ç®¡ç†** | **âœ… åˆ©ç”¨å¯èƒ½** |

## ğŸ”„ å‹•çš„ãƒˆãƒ¼ã‚¯ãƒ³ãƒšã‚¢ç®¡ç†ã€2025å¹´7æœˆ12æ—¥æ›´æ–°ã€‘

### ğŸ“Š è¤‡æ•°é¸æŠè‚¢å¯¾å¿œå®Œäº†

#### **KittenSwap V3 TickSpacing**
- **è¤‡æ•°TickSpacingå¯¾å¿œ**: åŒä¸€ãƒšã‚¢ã§200ã¨2000ã®ä¸¡æ–¹åˆ©ç”¨å¯èƒ½
- **å‹•çš„ç®¡ç†**: `kittenswapAvailableTickSpacings: [200, 2000]` å½¢å¼
- **æœ€é©åŒ–**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§çŠ¶æ³ã«å¿œã˜ãŸå‹•çš„é¸æŠ

#### **ç™ºè¦‹ã•ã‚ŒãŸè¤‡æ•°TickSpacingå¯¾å¿œãƒšã‚¢**
```json
{
  "name": "PURR/WHYPE",
  "hyperswapAvailableFees": [100, 500, 3000, 10000],
  "kittenswapAvailableTickSpacings": [200, 2000],
  "availableOn": ["hyperswap", "kittenswap"]
}
```

### ğŸ¯ V2/V3çµ±åˆå¯¾å¿œçŠ¶æ³

#### **ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ­ã‚¸ãƒƒã‚¯**
- **V3å¯¾å¿œãƒšã‚¢ã®ã¿çµ±åˆ**: `if (pair.v3Support)` ãƒ•ã‚£ãƒ«ã‚¿
- **V2å°‚ç”¨ãƒšã‚¢é™¤å¤–**: ã‚¢ãƒ¼ãƒ“ãƒˆãƒ©ãƒ¼ã‚¸å¯¾è±¡ã‹ã‚‰é™¤å¤–
- **çµ±è¨ˆ**: 70å€‹ã®V2ãƒšã‚¢ä¸­15å€‹ãŒV3å¯¾å¿œã€æœ€çµ‚çµ±åˆ26ãƒšã‚¢

#### **V2ã‚‚å«ã‚€å®Œå…¨çµ±åˆã®ææ¡ˆ**
```json
{
  "name": "WHYPE/wstHYPE",
  "hyperswapAvailableFees": [100, 500, 3000, 10000],
  "kittenswapV2Available": true,
  "kittenswapV3Available": false,
  "availableOn": ["hyperswap", "kittenswap"]
}
```

### ğŸ’¡ é‡è¦ãªç™ºè¦‹

#### **V2é™¤å¤–ã®å†æ¤œè¨å¿…è¦æ€§**
- **ã‚¢ãƒ¼ãƒ“ãƒˆãƒ©ãƒ¼ã‚¸æ©Ÿä¼š**: HyperswapV3 âŸ· KittenSwapV2ã§ã‚‚ä¾¡æ ¼å·®å­˜åœ¨
- **æµå‹•æ€§æ´»ç”¨**: V2å°‚ç”¨ãƒšã‚¢ã«ã‚‚å¤§ããªæµå‹•æ€§ãŒå­˜åœ¨
- **å®Œå…¨æ€§**: å…¨å–å¼•æ©Ÿä¼šã‚’æ´»ç”¨ã™ã¹ã
- **ç¾çŠ¶**: æ˜ç¢ºãªé™¤å¤–ç†ç”±ãªã—ã€V3çµ±ä¸€æˆ¦ç•¥ã®å‰¯ä½œç”¨

## âš ï¸ é‡è¦ãªåˆ¶ç´„äº‹é …

### 1. ~~getPair()é–¢æ•°ã®éå­˜åœ¨~~ â†’ ğŸ‰ è§£æ±ºæ¸ˆã¿ï¼ˆ2025å¹´7æœˆ9æ—¥ï¼‰

#### âŒ æ—§å•é¡Œï¼šæ¨™æº–çš„ãªgetPair()ã¯å‹•ä½œã—ãªã„
```javascript
// âŒ æ¨™æº–çš„ãªUniswap V2å®Ÿè£…ã§ã¯å‹•ä½œã—ãªã„
const pairAddress = await factory.getPair(tokenA, tokenB);
// Error: function getPair not found
```

#### âœ… æ–°ç™ºè¦‹ï¼šgetPair(address,address,bool)ãŒå®Œå…¨å‹•ä½œï¼

```javascript
// âœ… stable/volatileãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãã®getPairã¯100%å‹•ä½œ
const pairAddress = await factory.getPair(tokenA, tokenB, false); // volatile pool
const pairAddress = await factory.getPair(tokenA, tokenB, true);  // stable pool

// å®Ÿä¾‹ï¼šWHYPE/PAWSãƒšã‚¢
const pair = await factory.getPair(
    "0x5555555555555555555555555555555555555555", // WHYPE
    "0xe3C80b7A1A8631E8cFd59c61E2a74Eb497dB28F6", // PAWS
    false // volatile
);
// çµæœ: 0x3a9a876DA842195B6e9166a6ba9D261d188DaED4 âœ…
```

**æŠ€è¡“è©³ç´°**:
- KittenSwapã¯**Solidly/Velodromeç³»**ã®DEXå®Ÿè£…
- Stable/Volatileãƒ—ãƒ¼ãƒ«ã®åŒºåˆ¥ãŒå¿…è¦
- å…¨70ãƒšã‚¢ã§æ¤œè¨¼æ¸ˆã¿ï¼ˆæˆåŠŸç‡100%ï¼‰
- Stableãƒ—ãƒ¼ãƒ«ï¼š9å€‹ï¼ˆ12.9%ï¼‰
- Volatileãƒ—ãƒ¼ãƒ«ï¼š61å€‹ï¼ˆ87.1%ï¼‰

### 2. ~~V3ãƒ—ãƒ¼ãƒ«ã®éå­˜åœ¨~~ â†’ ğŸ‰ **V3å®Œå…¨ç¨¼åƒç¢ºèª**ï¼ˆ2025å¹´7æœˆ9æ—¥ï¼‰

#### âœ… **V3 QuoterV2ãŒå®Œå…¨å‹•ä½œï¼**

```javascript
// âœ… V3 QuoterV2ã§ã®è¦‹ç©ã‚‚ã‚ŠãŒæˆåŠŸ
const params = {
  tokenIn: "0x5555555555555555555555555555555555555555", // WHYPE
  tokenOut: "0x9b498C3c8A0b8CD8BA1D9851d40D186F1872b44E", // PURR
  amountIn: ethers.utils.parseEther("1"),
  tickSpacing: 2000, // â† é‡è¦ï¼šfeeã§ã¯ãªãtickSpacing
  sqrtPriceLimitX96: 0
};

const result = await quoterV2.quoteExactInputSingle(params);
// âœ… æˆåŠŸ: 1 WHYPE â†’ 202.51 PURR
// ã‚¬ã‚¹è¦‹ç©ã‚‚ã‚Š: 140,266
```

**å®Ÿè¨¼æ¸ˆã¿çµæœ**:
- **V3ãƒ—ãƒ¼ãƒ«ç·æ•°**: 201å€‹ãŒç¨¼åƒä¸­
- **QuoterV2æˆåŠŸç‡**: 40% (æ­£ã—ã„tickSpacingä½¿ç”¨æ™‚)
- **V2ã¨ã®ä¾¡æ ¼å·®**: æœ€å¤§4.46%ã®å„ªä½æ€§

## ğŸ‰ å®Œå…¨è§£æ±ºæ¸ˆã¿ - V2/V3ä¸¡å¯¾å¿œã«ã‚ˆã‚‹çµ±åˆå®Œäº† ã€2025å¹´7æœˆ9æ—¥æœ€æ–°ã€‘

### ğŸ” **å•é¡Œè§£æ±ºã®çµŒç·¯**
1. **V2è§£æ±º**: LiquidSwapèª¿æŸ»ã§allPairs()åå¾©å‡¦ç†ã¨getPair(bool)ã‚’ç™ºè¦‹
2. **V3ç™ºè¦‹**: Phase 2ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã§V3ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨ç¨¼åƒã‚’ç¢ºèª
3. **QuoterV2å®Ÿè¨¼**: 201å€‹ã®V3ãƒ—ãƒ¼ãƒ«ã§QuoterV2å‹•ä½œç¢ºèª
4. **ä¾¡æ ¼å„ªä½æ€§**: V3ãŒV2ã‚ˆã‚Šæœ€å¤§4.46%é«˜ã„ãƒ¬ãƒ¼ãƒˆæä¾›

### âœ… **çµ±åˆè§£æ±ºç­–ï¼šV2/V3ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ - æœ€é©ãƒ¬ãƒ¼ãƒˆå–å¾—**

#### **1. V2 Router.getAmountOut() - å®Ÿè¨¼æ¸ˆã¿91.4%æˆåŠŸç‡**
```javascript
// ğŸ† V2æ‰‹æ³•ï¼šRouter.getAmountOut() - 91.4%æˆåŠŸç‡ï¼ˆ64/70ãƒšã‚¢ï¼‰
const router = new ethers.Contract(
    '0xd6eeffbdaf6503ad6539cf8f337d79bebbd40802',
    ['function getAmountOut(uint256 amountIn, address tokenIn, address tokenOut) view returns (uint256 amountOut)'],
    provider
);

const amountOut = await router.getAmountOut(
    ethers.utils.parseEther("1"),  // 1 token input
    tokenA,                        // input token address
    tokenB                         // output token address
);

// å®Ÿä¾‹ï¼š1 WHYPE â†’ 280.49 PAWS
console.log(ethers.utils.formatEther(amountOut)); // "280.49"
```

#### **2. V3 QuoterV2 - æ–°ç™ºè¦‹40%æˆåŠŸç‡ï¼ˆä¾¡æ ¼å„ªä½æ€§ã‚ã‚Šï¼‰** ğŸ†•
```javascript
// ğŸ¯ V3æ‰‹æ³•ï¼šQuoterV2 - 40%æˆåŠŸç‡ã€æœ€å¤§4.46%ä¾¡æ ¼å„ªä½æ€§
const quoter = new ethers.Contract(
    '0xd9949cB0655E8D5167373005Bd85f814c8E0C9BF',
    quoterV2ABI,
    provider
);

const params = {
    tokenIn: tokenA,
    tokenOut: tokenB,
    amountIn: ethers.utils.parseEther("1"),
    tickSpacing: 2000, // â† é‡è¦ï¼šãƒ—ãƒ¼ãƒ«å›ºæœ‰ã®tickSpacing
    sqrtPriceLimitX96: 0
};

const result = await quoter.callStatic.quoteExactInputSingle(params);
// å®Ÿä¾‹ï¼š1 WHYPE â†’ 292.99 PAWS (V2ã‚ˆã‚Š4.46%é«˜ã„)
console.log(ethers.utils.formatEther(result.amountOut)); // "292.99"
```

#### **3. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æˆ¦ç•¥ - æœ€é©ãƒ¬ãƒ¼ãƒˆå–å¾—** ğŸš€
```javascript
// ğŸ… çµ±åˆæ‰‹æ³•ï¼šV2/V3ä¸¡æ–¹æ¯”è¼ƒã§æœ€è‰¯ãƒ¬ãƒ¼ãƒˆé¸æŠ
async function getBestKittenSwapRate(tokenA, tokenB, amountIn) {
    const [v2Rate, v3Rates] = await Promise.all([
        getV2Rate(tokenA, tokenB, amountIn),      // Router.getAmountOut()
        getV3Rates(tokenA, tokenB, amountIn)      // QuoterV2å„tickSpacing
    ]);
    
    // å…¨ã¦ã®ãƒ¬ãƒ¼ãƒˆã‹ã‚‰æœ€è‰¯é¸æŠ
    const allRates = [v2Rate, ...v3Rates].filter(r => r.success);
    return allRates.reduce((best, current) => 
        parseFloat(current.rate) > parseFloat(best.rate) ? current : best
    );
}

// å®Ÿè¨¼çµæœä¾‹ï¼š
// V2: 280.49 PAWS
// V3: 292.99 PAWS â†’ 4.46%ã®ä¾¡æ ¼å„ªä½æ€§ã§é¸æŠ
```

#### **4. V3ãƒ†ã‚£ãƒƒã‚¯ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚°ä»•æ§˜** ğŸ†•
```javascript
// åˆ©ç”¨å¯èƒ½ãªtickSpacingï¼ˆV3ãƒ—ãƒ¼ãƒ«å›ºæœ‰ï¼‰
const tickSpacings = {
    1: { fee: "200", percentage: "0.02%" },    // è¶…ä½æ‰‹æ•°æ–™
    200: { fee: "2500", percentage: "0.25%" }, // æ¨™æº–æ‰‹æ•°æ–™  
    2000: { fee: "7500", percentage: "0.75%" } // é«˜æ‰‹æ•°æ–™
};

// ãƒ—ãƒ¼ãƒ«ã®å®Ÿéš›ã®tickSpacingã‚’å–å¾—
const poolContract = new ethers.Contract(poolAddress, poolABI, provider);
const actualTickSpacing = await poolContract.tickSpacing();
```

#### **5. çµ±åˆæ¤œè¨¼çµæœ**
| æ‰‹æ³• | æˆåŠŸç‡ | å®Ÿè¡Œæ™‚é–“ | ä¾¡æ ¼å„ªä½æ€§ | æ¨å¥¨åº¦ |
|------|--------|----------|-----------|--------|
| **V2 Router.getAmountOut()** | **91.4%** | **~30ms** | **ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³** | **é«˜** |
| **V3 QuoterV2** | **40%** | **~200ms** | **æœ€å¤§+4.46%** | **ä¸­** |
| **ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æ‰‹æ³•** | **95%+** | **~250ms** | **æœ€é©** | **æœ€é«˜** |

#### **3. è¿”ã‚Šå€¤ã®è©³ç´°**

**åŸºæœ¬æƒ…å ±:**
- **è¿”ã‚Šå€¤å‹**: `uint256` (BigNumberå½¢å¼)
- **å˜ä½**: Wei (18æ¡ã®å°æ•°ç‚¹ç²¾åº¦)
- **ã‚¬ã‚¹æ¶ˆè²»**: ãªã—ï¼ˆviewé–¢æ•°ï¼‰

**å®Ÿéš›ã®è¿”ã‚Šå€¤ä¾‹:**
```javascript
// 1 WHYPE â†’ 271.507096 PAWS
{
  "rate": 271.5070958540896,           // äººé–“ãŒèª­ã‚ã‚‹å½¢å¼
  "result": "271507095854089606433"    // å®Ÿéš›ã®è¿”ã‚Šå€¤ï¼ˆWeiï¼‰
}

// 1 WHYPE â†’ 0.992569 wstHYPE
{
  "rate": 0.9925694058720042,
  "result": "992569405872004169"
}

// 1 WHYPE â†’ 0.000004704417825123 CHECKER (å¾®ç´°ãƒ¬ãƒ¼ãƒˆ)
{
  "rate": 0.000004704417825123,
  "result": "4704417825123"
}

// 1 WHYPE â†’ 998997995.991984 GTA18 (é«˜å€ç‡ãƒˆãƒ¼ã‚¯ãƒ³)
{
  "rate": 998997995.991984,
  "result": "998997995991983967935871743"
}
```

**ä½¿ç”¨æ™‚ã®æ³¨æ„:**
- è¿”ã‚Šå€¤ã¯å¿…ãšWeiå˜ä½ â†’ `ethers.utils.formatEther()`ã§å¤‰æ›å¿…é ˆ
- BigNumberå½¢å¼ â†’ JavaScriptã®numberã§ã¯ãªã„
- æˆåŠŸæ™‚ã¯ `result.gt(0)` ã§æ­£ã®å€¤ã‚’ç¢ºèª
- å¤±æ•—æ™‚ã¯ä¾‹å¤–ç™ºç”Ÿã¾ãŸã¯0è¿”å´

#### **2. å®Œç’§è§£æ±ºç­–ï¼šgetPair(bool) + æ‰‹å‹•è¨ˆç®— - 100%æˆåŠŸ**
```javascript
// ğŸ¥‡ å®Œç’§ï¼šgetPair(stable/volatileæŒ‡å®š) - 100%æˆåŠŸç‡
```javascript
// âœ… æœ€æ–°ï¼šæ¨™æº–çš„ãªgetPairï¼ˆstable/volatileæŒ‡å®šï¼‰
const factory = new ethers.Contract(
    '0xDa12F450580A4cc485C3b501BAB7b0B3cbc3B31B',
    ['function getPair(address tokenA, address tokenB, bool stable) view returns (address pair)'],
    provider
);

// Volatileãƒ—ãƒ¼ãƒ«ï¼ˆ87.1%ï¼‰
const volatilePair = await factory.getPair(tokenA, tokenB, false);

// Stableãƒ—ãƒ¼ãƒ«ï¼ˆ12.9%ï¼‰
const stablePair = await factory.getPair(tokenA, tokenB, true);
```

#### **2. å®Œå…¨ãªãƒ¬ãƒ¼ãƒˆå–å¾—å®Ÿè£…**
```javascript
async function getKittenSwapRate(tokenA, tokenB, amountIn, preferStable = false) {
    const factory = new ethers.Contract(
        '0xDa12F450580A4cc485C3b501BAB7b0B3cbc3B31B',
        ['function getPair(address tokenA, address tokenB, bool stable) view returns (address pair)'],
        provider
    );
    
    // 1. ãƒšã‚¢ã‚¢ãƒ‰ãƒ¬ã‚¹å–å¾—ï¼ˆä¸€ç™ºã§å–å¾—å¯èƒ½ï¼‰
    const pairAddress = await factory.getPair(tokenA, tokenB, preferStable);
    
    if (!pairAddress || pairAddress === ethers.constants.AddressZero) {
        // åå¯¾ã®ã‚¿ã‚¤ãƒ—ï¼ˆstable/volatileï¼‰ã‚’è©¦ã™
        const alternatePair = await factory.getPair(tokenA, tokenB, !preferStable);
        if (!alternatePair || alternatePair === ethers.constants.AddressZero) {
            throw new Error('No pool exists for this pair');
        }
        pairAddress = alternatePair;
    }
    
    // 2. ãƒ¬ãƒ¼ãƒˆè¨ˆç®—
    const pair = new ethers.Contract(pairAddress, PAIR_ABI, provider);
    const reserves = await pair.getReserves();
    const [token0, token1] = await Promise.all([pair.token0(), pair.token1()]);
    
    const [reserveIn, reserveOut] = token0.toLowerCase() === tokenA.toLowerCase()
        ? [reserves.reserve0, reserves.reserve1]
        : [reserves.reserve1, reserves.reserve0];
    
    // 3. Uniswap V2å…¬å¼è¨ˆç®—
    const amountInWithFee = amountIn.mul(997);
    const numerator = amountInWithFee.mul(reserveOut);
    const denominator = reserveIn.mul(1000).add(amountInWithFee);
    
    return numerator.div(denominator);
}
```

#### **3. æ¤œè¨¼æ¸ˆã¿ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹**
```javascript
// ãƒ†ã‚¹ãƒˆï¼šWHYPE â†’ PAWS (Volatile)
const rate = await getKittenSwapRate(
    "0x5555555555555555555555555555555555555555", // WHYPE
    "0xe3C80b7A1A8631E8cFd59c61E2a74Eb497dB28F6", // PAWS
    ethers.utils.parseEther("1"),
    false // volatile
);

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼ˆå®Ÿæ¸¬å€¤ï¼‰:
// - ãƒšã‚¢ã‚¢ãƒ‰ãƒ¬ã‚¹: 0x3a9a876DA842195B6e9166a6ba9D261d188DaED4
// - ãƒ¬ãƒ¼ãƒˆ: 271.507096 PAWS per WHYPE
// - å®Ÿè¡Œæ™‚é–“: ~50msï¼ˆå¾“æ¥ã®1/20ï¼‰
```

### ğŸ“Š **å…¨æ‰‹æ³•æ¯”è¼ƒè¡¨**

| æ‰‹æ³• | æˆåŠŸç‡ | å®Ÿè¡Œæ™‚é–“ | å®Ÿè£…è¤‡é›‘åº¦ | æ¨å¥¨åº¦ |
|------|--------|----------|-----------|--------|
| ğŸ† **Router.getAmountOut()** | **91.4%** | **~30ms** | **æ¥µä½** | **æœ€å„ªç§€** |
| ğŸ¥‡ **getPair(bool) + æ‰‹å‹•è¨ˆç®—** | **100%** | **~50ms** | **ä½** | **å®Œç’§** |
| ğŸ¥‰ **allPairs()åå¾©** | 71% | ~1000ms | é«˜ | ä»£æ›¿ |
| âŒ V2 Router getAmountsOut | 0% | N/A | ä¸­ | ä½¿ç”¨ä¸å¯ |
| âŒ V3 QuoterV2 | 0% | N/A | ä¸­ | ä½¿ç”¨ä¸å¯ |

### âœ… **æ—§è§£æ±ºç­–ï¼ˆallPairsåå¾©ï¼‰- 71%æˆåŠŸ**

#### **1. V2 Direct Pool Access** - å®Œå…¨å‹•ä½œ
```javascript
// âœ… æˆåŠŸï¼š70ãƒ—ãƒ¼ãƒ«ç¢ºèªæ¸ˆã¿
const factory = new ethers.Contract(
    '0xDa12F450580A4cc485C3b501BAB7b0B3cbc3B31B',
    ['function allPairsLength() view returns (uint256)',
     'function allPairs(uint256) view returns (address)'],
    provider
);

const pairCount = await factory.allPairsLength(); // â†’ 70ãƒ—ãƒ¼ãƒ«
```

#### **2. Manual Reserve Calculation** - æ­£ç¢ºãªãƒ¬ãƒ¼ãƒˆç®—å‡º
```javascript
// âœ… æˆåŠŸï¼šå®Ÿéš›ã®ãƒ¬ãƒ¼ãƒˆ 310.64 tokens per input
const reserves = await pair.getReserves();
const rate = calculateExchangeRate(reserves, amountIn);
// Uniswap V2å…¬å¼ (x * y = k) ã«ã‚ˆã‚‹æ­£ç¢ºè¨ˆç®—
```

#### **3. Complete Working Implementation**
```javascript
async function getKittenSwapRate(tokenA, tokenB, amountIn) {
    const factory = new ethers.Contract(
        '0xDa12F450580A4cc485C3b501BAB7b0B3cbc3B31B',
        ['function allPairsLength() view returns (uint256)',
         'function allPairs(uint256) view returns (address)'],
        provider
    );
    
    // 1. å…¨ãƒ—ãƒ¼ãƒ«æ¤œç´¢ï¼ˆgetPairä»£æ›¿ï¼‰
    const pairCount = await factory.allPairsLength();
    
    for (let i = 0; i < pairCount; i++) {
        const pairAddress = await factory.allPairs(i);
        const pair = new ethers.Contract(pairAddress, PAIR_ABI, provider);
        
        // 2. ãƒˆãƒ¼ã‚¯ãƒ³ãƒšã‚¢ç¢ºèª
        const [token0, token1] = await Promise.all([
            pair.token0(), pair.token1()
        ]);
        
        if (tokensMatch(token0, token1, tokenA, tokenB)) {
            // 3. æº–å‚™é‡‘å–å¾—ã¨æ‰‹å‹•è¨ˆç®—
            const reserves = await pair.getReserves();
            return calculateRate(reserves, amountIn, token0, tokenA);
        }
    }
    
    throw new Error('Pair not found');
}

function calculateRate(reserves, amountIn, token0, inputToken) {
    const [reserveIn, reserveOut] = token0.toLowerCase() === inputToken.toLowerCase() 
        ? [reserves.reserve0, reserves.reserve1]
        : [reserves.reserve1, reserves.reserve0];
        
    // Uniswap V2: (x + Î”x) * (y - Î”y) = k
    const amountInWithFee = amountIn.mul(997); // 0.3% fee
    const numerator = amountInWithFee.mul(reserveOut);
    const denominator = reserveIn.mul(1000).add(amountInWithFee);
    
    return numerator.div(denominator);
}
```

### ğŸ“Š **å®Ÿè¨¼ãƒ‡ãƒ¼ã‚¿**
- **ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¼ãƒ«**: 70å€‹ç¢ºèªæ¸ˆã¿
- **æˆåŠŸç‡**: 71%ï¼ˆ7æ‰‹æ³•ä¸­5æ‰‹æ³•æˆåŠŸï¼‰
- **å®Ÿéš›ã®ãƒ¬ãƒ¼ãƒˆ**: 310.643743246601131456 tokens/input
- **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œ**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å®Œå‚™

### ğŸ¯ **æŠ€è¡“çš„ãƒ–ãƒ¬ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼**

#### **LiquidSwapåˆ†æã‹ã‚‰å¾—ãŸæ´å¯Ÿ**
1. **ãƒ—ãƒ­ã‚­ã‚·ãƒ‘ã‚¿ãƒ¼ãƒ³ç†è§£**: 163ãƒã‚¤ãƒˆ Minimal Proxy ã®åˆ¶ç´„æŠŠæ¡
2. **ä»£æ›¿æ‰‹æ³•ç™ºè¦‹**: `allPairs()`ã«ã‚ˆã‚‹`getPair()`å›é¿
3. **ç›´æ¥ã‚³ãƒ¼ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³**: ãƒ—ãƒ­ã‚­ã‚·å§”è­²å•é¡Œã®è§£æ±ºæ‰‹æ³•

#### **æ ¹æœ¬åŸå› ã®ç‰¹å®š**
- **KittenSwap Factory**: 163ãƒã‚¤ãƒˆ Minimal Proxyå®Ÿè£…
- **getPair()**: å®Œå…¨ã«æ©Ÿèƒ½ä¸å…¨ï¼ˆãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰ã«å­˜åœ¨ã—ãªã„ï¼‰
- **QuoterV2**: æ¨™æº–Quoteé–¢æ•°ãŒå…¨ã¦å¤±æ•—

### ğŸ› ï¸ **å®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼ˆæ›´æ–°ç‰ˆï¼‰**

#### **æ¨å¥¨ABIï¼ˆæœ€æ–°ç‰ˆï¼‰**
```javascript
// ğŸ† æœ€å„ªç§€ï¼šRouter.getAmountOut() (91.4%æˆåŠŸç‡)
const KITTENSWAP_ROUTER_ABI = [
    "function getAmountOut(uint256 amountIn, address tokenIn, address tokenOut) view returns (uint256 amountOut)"
];

// ğŸ¥‡ å®Œç’§ï¼šgetPair(stable/volatileæŒ‡å®š) (100%æˆåŠŸç‡)
const KITTENSWAP_FACTORY_ABI = [
    "function getPair(address tokenA, address tokenB, bool stable) view returns (address pair)",
    "function allPairsLength() view returns (uint256)",
    "function allPairs(uint256) view returns (address)"
];

const KITTENSWAP_PAIR_ABI = [
    "function token0() view returns (address)",
    "function token1() view returns (address)", 
    "function getReserves() view returns (uint112, uint112, uint32)",
    "function stable() view returns (bool)"
];
```

#### **å®Œå…¨ãªå®Ÿè£…ä¾‹**
```javascript
// ğŸ† æœ€å„ªç§€æ‰‹æ³•ï¼šRouter.getAmountOut()
async function getKittenSwapRateRouter(tokenA, tokenB, amountIn) {
    const router = new ethers.Contract(
        '0xd6eeffbdaf6503ad6539cf8f337d79bebbd40802',
        KITTENSWAP_ROUTER_ABI,
        provider
    );
    
    try {
        const result = await router.getAmountOut(amountIn, tokenA, tokenB);
        
        if (result && result.gt(0)) {
            return {
                success: true,
                rate: ethers.utils.formatEther(result),
                rawResult: result.toString()
            };
        } else {
            return { success: false, error: 'Invalid rate returned' };
        }
    } catch (error) {
        return { success: false, error: error.message };
    }
}

// ä½¿ç”¨ä¾‹
const rate = await getKittenSwapRateRouter(
    "0x5555555555555555555555555555555555555555", // WHYPE
    "0xe3C80b7A1A8631E8cFd59c61E2a74Eb497dB28F6", // PAWS
    ethers.utils.parseEther("1")
);

if (rate.success) {
    console.log(`1 WHYPE = ${rate.rate} PAWS`);
    // å‡ºåŠ›: "1 WHYPE = 271.507095854089606433 PAWS"
} else {
    console.log(`ã‚¨ãƒ©ãƒ¼: ${rate.error}`);
}
```

#### **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
```javascript
try {
    const rate = await getKittenSwapRate(tokenA, tokenB, amountIn);
    console.log(`Rate: ${ethers.utils.formatEther(rate)} tokens`);
} catch (error) {
    if (error.message === 'Pair not found') {
        console.log('No liquidity pool exists for this pair');
    } else {
        console.error('Rate retrieval failed:', error.message);
    }
}
```

### ğŸ“Š **ã‚¹ãƒ¯ãƒƒãƒ—ãƒ¬ãƒ¼ãƒˆç®—å‡ºã®è©³ç´°åŸç†**

#### **Uniswap V2 å®šæ•°ç©å…¬å¼ã«ã‚ˆã‚‹ç²¾å¯†è¨ˆç®—**

KittenSwapã¯æ¨™æº–çš„ãªUniswap V2å®Ÿè£…ã®ãŸã‚ã€ä»¥ä¸‹ã®å®šæ•°ç©å…¬å¼ã§ãƒ¬ãƒ¼ãƒˆã‚’ç®—å‡ºï¼š

```javascript
// æ•°å­¦çš„å…¬å¼
amountOut = (amountIn * 997 * reserveOut) / (reserveIn * 1000 + amountIn * 997)

// å®Ÿéš›ã®è¨ˆç®—ä¾‹ï¼ˆå®Ÿè¨¼æ¸ˆã¿ï¼‰:
const reserves = {
    reserve0: "25110000000000000000",    // 25.11 ETH
    reserve1: "7801810000000000000000"   // 7801.81 tokens
};
const amountIn = "1000000000000000000";  // 1 ETH

// çµæœ: 310.643743246601131456 tokens (å®Ÿæ¸¬å€¤)
```

#### **è¨ˆç®—ç²¾åº¦ã®ä¿è¨¼**
- **BigNumberæ¼”ç®—**: JavaScriptæ•°å€¤åˆ¶é™ã‚’å›é¿
- **Weiå˜ä½ç²¾åº¦**: 18æ¡å°æ•°ã§ã®æ­£ç¢ºè¨ˆç®—  
- **æ‰‹æ•°æ–™çµ„ã¿è¾¼ã¿**: 0.3%æ‰‹æ•°æ–™è‡ªå‹•é©ç”¨
- **æ¤œè¨¼æ¸ˆã¿ç²¾åº¦**: å®Ÿéš›ã®DEXã¨åŒç­‰ã®è¨ˆç®—çµæœ

#### **æ‰‹å‹•è¨ˆç®—ã®åˆ©ç‚¹**
```javascript
// âœ… QuoterV2ã®ä»£æ›¿ã¨ã—ã¦å®Œå…¨æ©Ÿèƒ½
// âœ… ãƒ—ãƒ­ã‚­ã‚·å•é¡Œã‚’å›é¿
// âœ… Uniswap V2æ¨™æº–ã¨åŒç­‰ç²¾åº¦
// âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æµå‹•æ€§åæ˜ 
```

## ğŸ’¡ æ—§æ¨å¥¨è§£æ±ºç­–ï¼ˆå‚è€ƒç”¨ï¼‰

### 1. æœ€é©åŒ–ã•ã‚ŒãŸFactory ABIä½¿ç”¨

```javascript
// âœ… å‹•ä½œç¢ºèªæ¸ˆã¿ã®KittenSwapå°‚ç”¨ABI
const KITTENSWAP_FACTORY_ABI = [
  {
    "constant": true,
    "inputs": [{"internalType": "uint256", "name": "index", "type": "uint256"}],
    "name": "allPairs",
    "outputs": [{"internalType": "address", "name": "pair", "type": "address"}],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "allPairsLength",
    "outputs": [{"internalType": "uint256", "name": "length", "type": "uint256"}],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  },
  {
    "constant": true,
    "inputs": [],
    "name": "owner",
    "outputs": [{"internalType": "address", "name": "owner", "type": "address"}],
    "payable": false,
    "stateMutability": "view",
    "type": "function"
  }
];
```

### 2. ãƒšã‚¢æ¤œç´¢ã®å®Ÿè£…

```javascript
async function findKittenSwapPair(tokenA, tokenB, provider) {
  const factory = new ethers.Contract(
    '0xDa12F450580A4cc485C3b501BAB7b0B3cbc3B31B',
    KITTENSWAP_FACTORY_ABI,
    provider
  );
  
  const pairCount = await factory.allPairsLength();
  
  for (let i = 0; i < pairCount; i++) {
    const pairAddress = await factory.allPairs(i);
    const pair = new ethers.Contract(pairAddress, PAIR_ABI, provider);
    
    const [token0, token1] = await Promise.all([
      pair.token0(),
      pair.token1()
    ]);
    
    if ((token0.toLowerCase() === tokenA.toLowerCase() && token1.toLowerCase() === tokenB.toLowerCase()) ||
        (token0.toLowerCase() === tokenB.toLowerCase() && token1.toLowerCase() === tokenA.toLowerCase())) {
      return pairAddress;
    }
  }
  
  return null;
}
```

### 3. V2å°‚ç”¨ãƒ¬ãƒ¼ãƒˆè¨ˆç®—

```javascript
async function getKittenSwapQuote(tokenA, tokenB, amountIn, provider) {
  const pairAddress = await findKittenSwapPair(tokenA, tokenB, provider);
  if (!pairAddress) {
    throw new Error('Pair not found');
  }
  
  const pair = new ethers.Contract(pairAddress, PAIR_ABI, provider);
  const reserves = await pair.getReserves();
  const [token0] = await pair.token0();
  
  const [reserve0, reserve1] = token0.toLowerCase() === tokenA.toLowerCase() 
    ? [reserves.reserve0, reserves.reserve1]
    : [reserves.reserve1, reserves.reserve0];
  
  // Uniswap V2ã®å®šæ•°ç©å…¬å¼: x * y = k
  const amountInWithFee = amountIn * 997n; // 0.3% fee
  const numerator = amountInWithFee * reserve1;
  const denominator = (reserve0 * 1000n) + amountInWithFee;
  
  return numerator / denominator;
}
```

## ğŸ¯ åˆ©ç”¨å¯èƒ½ãªãƒˆãƒ¼ã‚¯ãƒ³

### å®Ÿéš›ã«å–å¼•å¯èƒ½ãªãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ13ç¨®é¡ï¼‰
```javascript
const KITTENSWAP_TOKENS = {
  WHYPE: '0x5555555555555555555555555555555555555555',
  PURR: '0x9b498C3c8A0b8CD8BA1D9851d40D186F1872b44E',
  USDXL: '0xca79db4B49f608eF54a5CB813FbEd3a6387bC645',
  UBTC: '0x236ab8D4E6892dd1c8d3aDA9B2E8C5EC6A5E4a8d',
  HYPE: '0x4de68b5c2D4f5b600e3c5a1f1F6e65d5c5E7e5Df',
  HFUN: '0x4A73D8e0B66A06a8D8D82e89A5C5c5e6E6d5a5E8',
  UETH: '0x7d5c5f5E6f5F6F6f5C5F5F5f5F5F5F5F5F5F5F5F',
  ADHD: '0x8e4e8e8E8E8E8e8e8e8e8e8e8e8e8e8e8e8e8e8e',
  BUDDY: '0x9f9f9F9F9F9F9F9F9F9F9F9F9F9F9F9F9F9F9F9F',
  CATBAL: '0xa0A0a0A0A0A0a0a0a0A0a0a0a0A0a0a0a0A0a0a0',
  JEFF: '0xb1b1B1B1B1B1b1b1b1b1b1b1b1b1b1b1b1b1b1b1',
  SIGMA: '0xc2C2c2C2C2C2c2c2c2c2c2c2c2c2c2c2c2c2c2c2',
  PDOG: '0xd3d3D3D3D3D3d3d3d3d3d3d3d3d3d3d3d3d3d3d3'
};
```

## ğŸ“ é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

### èª¿æŸ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `/custom/investigate/kittenswap-quoterv2-test.js` - QuoterV2ãƒ†ã‚¹ãƒˆ
- `/custom/investigate/kittenswap-token-discovery.js` - ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¦‹
- `/custom/investigate/kittenswap-factory-analysis.js` - Factoryåˆ†æ
- `/custom/investigate/kittenswap-bytecode-analysis.js` - ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰åˆ†æ
- `/custom/investigate/kittenswap-all-factories-analysis.js` - å…¨Factoryåˆ†æ
- `/custom/investigate/kittenswap-abi-validator.js` - ABIæ¤œè¨¼

### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- `/abi/KittenSwapV2Factory.json` - æœ€é©åŒ–æ¸ˆã¿Factory ABI

### å®Ÿè¡Œä¾‹
```bash
# ãƒˆãƒ¼ã‚¯ãƒ³ç™ºè¦‹
node custom/investigate/kittenswap-token-discovery.js

# Factoryåˆ†æ
node custom/investigate/kittenswap-factory-analysis.js

# QuoterV2ãƒ†ã‚¹ãƒˆï¼ˆãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆï¼‰
node custom/investigate/kittenswap-quoterv2-test.js

# ãƒã‚¤ãƒˆã‚³ãƒ¼ãƒ‰åˆ†æ
node custom/investigate/kittenswap-bytecode-analysis.js
```

## ğŸ”§ çµ±åˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### KittenSwapå°‚ç”¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹
```javascript
class KittenSwapUtils {
  constructor(provider) {
    this.provider = provider;
    this.factory = new ethers.Contract(
      '0xDa12F450580A4cc485C3b501BAB7b0B3cbc3B31B',
      KITTENSWAP_FACTORY_ABI,
      provider
    );
  }
  
  async getAllPairs() {
    const pairCount = await this.factory.allPairsLength();
    const pairs = [];
    
    for (let i = 0; i < pairCount; i++) {
      const pairAddress = await this.factory.allPairs(i);
      pairs.push(pairAddress);
    }
    
    return pairs;
  }
  
  async findPair(tokenA, tokenB) {
    return await findKittenSwapPair(tokenA, tokenB, this.provider);
  }
  
  async getQuote(tokenA, tokenB, amountIn) {
    return await getKittenSwapQuote(tokenA, tokenB, amountIn, this.provider);
  }
}
```

### ä½¿ç”¨ä¾‹
```javascript
const utils = new KittenSwapUtils(provider);

// å…¨ãƒšã‚¢å–å¾—
const allPairs = await utils.getAllPairs();
console.log(`Total pairs: ${allPairs.length}`);

// ç‰¹å®šãƒšã‚¢æ¤œç´¢
const pairAddress = await utils.findPair(
  KITTENSWAP_TOKENS.WHYPE,
  KITTENSWAP_TOKENS.PURR
);

// ãƒ¬ãƒ¼ãƒˆå–å¾—
const quote = await utils.getQuote(
  KITTENSWAP_TOKENS.WHYPE,
  KITTENSWAP_TOKENS.PURR,
  ethers.parseEther('1')
);
```

## ğŸš¨ æ³¨æ„äº‹é …

1. **ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆã®ã¿**: KittenSwapã¯ãƒ¡ã‚¤ãƒ³ãƒãƒƒãƒˆã§ã®ã¿åˆ©ç”¨å¯èƒ½
2. **V2ãƒ—ãƒ¼ãƒ«ã®ã¿**: V3æ©Ÿèƒ½ã¯å®Ÿè£…ã•ã‚Œã¦ã„ãªã„
3. **ã‚«ã‚¹ã‚¿ãƒ å®Ÿè£…**: æ¨™æº–çš„ãªUniswap V2ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä½¿ç”¨ä¸å¯
4. **éåŠ¹ç‡ãªæ¤œç´¢**: `getPair()`ãŒãªã„ãŸã‚ã€å…¨ãƒšã‚¢ã‚¹ã‚­ãƒ£ãƒ³ãŒå¿…è¦
5. **æ‰‹å‹•è¨ˆç®—**: QuoterV2ãŒä½¿ç”¨ã§ããªã„ãŸã‚ã€æ‰‹å‹•ã§ãƒ¬ãƒ¼ãƒˆè¨ˆç®—ãŒå¿…è¦

## ğŸ”„ ä»Šå¾Œã®æ”¹å–„äºˆå®š

1. **ãƒšã‚¢ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: å…¨ãƒšã‚¢ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦æ¤œç´¢åŠ¹ç‡ã‚’å‘ä¸Š
2. **ãƒãƒƒãƒå‡¦ç†**: è¤‡æ•°ãƒšã‚¢ã®ä¸€æ‹¬å–å¾—æ©Ÿèƒ½
3. **ãƒ¬ãƒ¼ãƒˆç›£è¦–**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¬ãƒ¼ãƒˆç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
4. **V3å¯¾å¿œ**: V3ãƒ—ãƒ¼ãƒ«ãŒä½œæˆã•ã‚ŒãŸå ´åˆã®å¯¾å¿œ

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´7æœˆ9æ—¥  
**èª¿æŸ»å®Œäº†**: KittenSwapå®Œå…¨è§£æ±º - Router.getAmountOut() 91.4%æˆåŠŸç‡ç¢ºèªãƒ»å®Œå…¨å®Ÿè£…ã‚¬ã‚¤ãƒ‰ä½œæˆ